"""
Homer
=====

Class to check Homer status.

:Authors:
    Gilles Bellot
"""

########################################################################################################################
# IMPORTS ##############################################################################################################
########################################################################################################################
import requests
from helpers import Credentials, CredentialLocations


########################################################################################################################
# DEFINITIONS ##########################################################################################################
########################################################################################################################

########################################################################################################################
# CLASS ################################################################################################################
########################################################################################################################
class Homer:
    __instance = None
    _credentials = Credentials(CredentialLocations.homer)
    _healthCheckURL = f'{_credentials.url}:{_credentials.port}' if _credentials.port is not None \
                      else f'{_credentials.url}'

    ####################################################################################################################
    # PUBLIC METHODS ###################################################################################################
    ####################################################################################################################
    @classmethod
    def isHealthy(cls) -> dict:
        try:
            # get health status
            result = requests.get(cls._healthCheckURL)

            if result.status_code != 200:
                isHealthy = False
                message = 'Homer is dead.'
            else:
                isHealthy = True
                message = 'Homer is alive.'

            return {'isHealthy': isHealthy, 'message': message, 'serviceName': cls.__name__}

        except Exception as e:
            raise RuntimeError(f'Homer Health Check - Error message: {e}')

    ####################################################################################################################
    # CONSTRUCTOR ######################################################################################################
    ####################################################################################################################
    def __new__(cls, *args, **kwargs):
        if cls.__instance is None:
            cls.__instance = super()
        return cls.__instance
